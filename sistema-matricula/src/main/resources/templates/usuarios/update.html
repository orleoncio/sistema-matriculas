<!DOCTYPE html>
<html lang="pt-BR"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Atualizar Usuário</title>
  <!-- Carrega Tailwind CSS CDN para estilização -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #f3f4f6;
    }
  </style>
</head>
<body class="p-10">

<div class="max-w-md mx-auto bg-white p-8 rounded-xl shadow-2xl">

  <!-- Botão Voltar para Lista -->
  <div class="mb-6">
    <a th:href="@{/usuarios}"
       class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-lg shadow-sm text-gray-700 bg-white hover:bg-gray-50 transition duration-150">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-4 h-4 mr-2"><path d="M19 12H5"/><path d="m12 19-7-7 7-7"/></svg>
      Voltar para Usuários
    </a>
  </div>

  <h2 class="text-3xl font-extrabold text-indigo-700 text-center mb-6 border-b pb-4">
    Atualizar Usuário: <span th:text="${usuarioDto.login}" class="text-indigo-900"></span>
  </h2>
  <p class="text-sm text-gray-500 text-center mb-6">Altere a Role ou defina uma nova senha, se necessário.</p>

  <!-- Mensagem de erro (se houver) -->
  <div th:if="${error}" class="p-3 rounded-lg bg-red-100 border border-red-400 text-red-700 text-sm mb-4">
    <p th:text="${error}"></p>
  </div>

  <!-- O formulário de atualização envia a requisição para /usuarios/atualizar/{id} com o método PUT (simulado via hidden field do Spring) -->
  <form th:action="@{/usuarios/atualizar/{id}(id=${usuarioDto.id})}" th:object="${usuarioDto}" method="POST" class="space-y-6">

    <!-- Hidden field para simular método PUT/PATCH no Thymeleaf -->
    <input type="hidden" name="_method" value="PUT" />

    <!-- Campo ID (Hidden) -->
    <input type="hidden" th:field="*{id}" />

    <!-- Campo LOGIN (Somente Leitura) -->
    <div>
      <label for="login" class="block text-sm font-medium text-gray-700">Login (Username)</label>
      <input type="text"
             id="login"
             th:field="*{login}"
             readonly
             class="mt-1 block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none sm:text-sm cursor-not-allowed"
      />
    </div>

    <!-- Campo ROLE (Para selecionar a nova role) -->
    <div>
      <label for="role" class="block text-sm font-medium text-gray-700">Nível de Acesso (Role)</label>
      <select id="role"
              th:field="*{role}"
              required
              class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
        <option value="" disabled>Selecione a Role</option>
        <!-- Itera sobre todas as roles para pré-selecionar a correta -->
        <option th:each="role : ${T(tjw.sistema_matricula.model.enums.Role).values()}"
                th:value="${role}"
                th:text="${role.name()}"
                th:selected="${role.name() == usuarioDto.role.name()}">
        </option>
      </select>
      <p th:if="${#fields.hasErrors('role')}" th:errors="*{role}" class="mt-2 text-sm text-red-600"></p>
    </div>

    <!-- Campo SENHA (Opcional - para redefinir a senha) -->
    <div>
      <label for="senha" class="block text-sm font-medium text-gray-700">Nova Senha</label>
      <input type="password"
             id="senha"
             th:field="*{senha}"
             class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"
             placeholder="Deixe em branco para manter a senha atual"
      />
      <p th:if="${#fields.hasErrors('senha')}" th:errors="*{senha}" class="mt-2 text-sm text-red-600"></p>
    </div>

    <!-- Token CSRF -->
    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" th:if="${_csrf}" />

    <!-- Botão de Submissão -->
    <div class="pt-4">
      <button type="submit"
              class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-150 ease-in-out">
        Salvar Alterações
      </button>
    </div>
  </form>

</div>

</body>
</html>